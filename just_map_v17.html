{% load static %}
<html>

<head>
    <title>Gold Data</title>
    <!-- Required meta tags -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <!-- <link rel="stylesheet" href="http://cdn.leafletjs.com/leaflet-0.7.2/leaflet.css" /> -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.7.1/dist/leaflet.css" />
    <!-- Bootstrap Multiselect CSS -->
    <link rel="stylesheet"
        href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-multiselect/0.9.13/css/bootstrap-multiselect.css">
    <!--[if lte IE 8]><link rel="stylesheet" href="http://cdn.leafletjs.com/leaflet-0.5.1/leaflet.ie.css" /><![endif]-->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/jqueryui/1.12.1/jquery-ui.min.css"
        type="text/css">
    <!-- Bootstrap CSS -->
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css"
        integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm" crossorigin="anonymous">
    <!-- Fonts CSS -->
    <!-- <link rel="preconnect" href="https://fonts.gstatic.com"> -->
    <link
        href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;500&family=Quicksand:wght@400;500&display=swap"
        rel="stylesheet">
    <!-- Daterange CSS -->
    <link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/daterangepicker/daterangepicker.css" />
    <link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.css">
    <link rel="stylesheet" type="text/css"
        href="https://cdnjs.cloudflare.com/ajax/libs/jquery.perfect-scrollbar/1.5.0/css/perfect-scrollbar.css">
    <!-- Custom CSS 
    <link href="./css/style.css" rel="stylesheet">-->
    <style>
        body,
        html {
            height: 100%;
            font-family: 'Quicksand', sans-serif;
            line-height: 1.15;
            background-color: #f7fbff;
        }

        /* ------------------------------------ */
        a {
            margin: 0px;
            transition: all 0.4s;
            -webkit-transition: all 0.4s;
            -o-transition: all 0.4s;
            -moz-transition: all 0.4s;
        }

        a:focus {
            outline: none !important;
        }

        a:hover {
            text-decoration: none;
        }

        /* ------------------------------------ */
        h1,
        h2,
        h3,
        h4,
        h5,
        h6 {
            line-height: 1.2;
            margin-bottom: 0.5rem;
        }

        p {
            margin-top: 0;
            margin-bottom: 1rem;
            font-weight: 300;
            letter-spacing: 0.5px;
        }

        h1 {
            font-size: 2.5rem;
        }

        h2 {
            font-size: 2rem;
        }

        h3 {
            font-size: 1.75rem;
        }

        h4 {
            font-size: 1.5rem;
        }

        h5 {
            font-size: 1.25rem;
        }

        h6 {
            font-size: 1rem;
        }

        ul {
            padding: 0 0 0 15px;
        }

        ol {
            padding: 0 0 0 20px
        }

        ul ul,
        ol ol {
            margin: 10px 0
        }

        ul,
        li {
            margin: 0px;
            list-style-type: none;
        }

        /********* Clear floats *********/
        .cf:before,
        .cf:after,
        .container:before,
        .container:after,
        .row:before,
        .row:after,
        ul:before,
        ul:after,
        .boxs:before,
        .boxs:after,
        .radioList:after,
        .radioList:before {
            content: " ";
            display: table
        }

        .cf:after,
        .container:after,
        .row:after,
        ul:after,
        .boxs:after,
        .radioList:after {
            clear: both
        }



        /*//////////////////////////////////////////////////////////////////
[ Table ]*/

        .limiter {
            width: 100%;
            margin: 0 auto;
        }

        .container-table100 {
            width: 100%;
            min-height: 100vh;
            background: #d1d1d1;

            display: -webkit-box;
            display: -webkit-flex;
            display: -moz-box;
            display: -ms-flexbox;
            display: flex;
            align-items: center;
            justify-content: center;
            flex-wrap: wrap;
            padding: 33px 30px;
        }

        .wrap-table100 {
            width: 1300px;
        }

        /*//////////////////////////////////////////////////////////////////
[ Table ]*/
        table {
            width: 100%;
            background-color: #fff;
        }

        th,
        td {
            font-weight: unset;
            padding-right: 10px;
        }

        .column100 {
            width: 130px;
            padding-left: 25px;
        }

        .column100.column1 {
            width: 265px;
            padding-left: 42px;
        }

        .row100.head th {
            padding-top: 24px;
            padding-bottom: 20px;
        }

        .row100 td {
            padding-top: 18px;
            padding-bottom: 14px;
        }


        /*==================================================================
[ Ver1 ]*/
        .table100.ver1 td {
            font-family: 'Montserrat', sans-serif;
            font-weight: 400;
            font-size: 14px;
            color: #808080;
            line-height: 1.4;
        }

        .table100.ver1 th {
            font-family: 'Montserrat', sans-serif;
            font-weight: 500;
            font-size: 12px;
            color: #fff;
            line-height: 1.4;
            text-transform: uppercase;
            background-color: #36304a;
        }

        .table100.ver1 .row100:hover {
            background-color: #f2f2f2;
        }

        .table100.ver1 .hov-column-ver1 {
            background-color: #f2f2f2;
        }

        .table100.ver1 .hov-column-head-ver1 {
            background-color: #484848;
        }

        .table100.ver1 .row100 td:hover {
            background-color: #6c7ae0;
            color: #fff;
        }

        /*==================================================================
[ Ver2 ]*/
        .table100.ver2 td {
            font-family: 'Montserrat', sans-serif;
            font-weight: 400;
            font-size: 14px;
            color: #808080;
            line-height: 1.4;
        }

        .table100.ver2 th {
            font-family: 'Montserrat', sans-serif;
            font-weight: 500;
            font-size: 12px;
            color: #fff;
            line-height: 1.4;
            text-transform: uppercase;

            background-color: #333333;
        }

        .table100.ver2 .row100:hover td {
            background-color: #83d160;
            color: #fff;
        }

        .table100.ver2 .hov-column-ver2 {
            background-color: #83d160;
            color: #fff;
        }

        .table100.ver2 .hov-column-head-ver2 {
            background-color: #484848;
        }

        .table100.ver2 .row100 td:hover {
            background-color: #57b846;
            color: #fff;
        }

        /*==================================================================
[ Ver2 ]*/
        .table100.ver2 tbody tr:nth-child(even) {
            background-color: #eaf8e6;
        }

        .table100.ver2 td {
            font-family: 'Montserrat', sans-serif;
            font-weight: 400;
            font-size: 14px;
            color: #808080;
            line-height: 1.4;
        }

        .table100.ver2 th {
            font-family: 'Montserrat', sans-serif;
            font-weight: 500;
            font-size: 12px;
            color: #fff;
            line-height: 1.4;
            text-transform: uppercase;

            background-color: #333333;
        }

        .table100.ver2 .row100:hover td {
            background-color: #83d160;
            color: #fff;
        }

        .table100.ver2 .hov-column-ver2 {
            background-color: #83d160;
            color: #fff;
        }

        .table100.ver2 .hov-column-head-ver2 {
            background-color: #484848;
        }

        .table100.ver2 .row100 td:hover {
            background-color: #57b846;
            color: #fff;
        }

        /*==================================================================
[ Ver3 ]*/
        .table100.ver3 tbody tr {
            border-bottom: 1px solid #e5e5e5;
        }

        .table100.ver3 td {
            font-family: 'Montserrat', sans-serif;
            font-weight: 400;
            font-size: 14px;
            color: #808080;
            line-height: 1.4;
        }

        .table100.ver3 th {
            font-family: 'Montserrat', sans-serif;
            font-weight: 500;
            font-size: 12px;
            color: #fff;
            line-height: 1.4;
            text-transform: uppercase;

            background-color: #6c7ae0;
        }

        .table100.ver3 .row100:hover td {
            background-color: #fcebf5;
        }

        .table100.ver3 .hov-column-ver3 {
            background-color: #fcebf5;
        }

        .table100.ver3 .hov-column-head-ver3 {
            background-color: #7b88e3;
        }

        .table100.ver3 .row100 td:hover {
            background-color: #e03e9c;
            color: #fff;
        }

        /*==================================================================
[ Ver4 ]*/

        .table100.ver4 td {
            font-family: 'Montserrat', sans-serif;
            font-weight: 400;
            font-size: 14px;
            color: #808080;
            line-height: 1.4;
        }

        .table100.ver4 th {
            font-family: 'Montserrat', sans-serif;
            font-weight: 500;
            font-size: 12px;
            color: #fff;
            line-height: 1.4;
            text-transform: uppercase;

            background-color: #fa4251;
        }

        .table100.ver4 .row100:hover td {
            color: #fa4251;
        }

        .table100.ver4 .hov-column-ver4 {
            background-color: #ffebed;
        }

        .table100.ver4 .hov-column-head-ver4 {
            background-color: #f95462;
        }

        .table100.ver4 .row100 td:hover {
            background-color: #ffebed;
            color: #fa4251;
        }

        /*==================================================================
[ Ver5 ]*/
        .table100.ver5 tbody tr:nth-child(even) {
            background-color: #e9faff;
        }

        .table100.ver5 td {
            font-family: 'Montserrat', sans-serif;
            font-weight: 400;
            font-size: 14px;
            color: #808080;
            line-height: 1.4;
            position: relative;
        }

        .table100.ver5 th {
            font-family: 'Montserrat', sans-serif;
            font-weight: 500;
            font-size: 12px;
            color: #fff;
            line-height: 1.4;
            text-transform: uppercase;

            background-color: #002933;
        }

        .table100.ver5 .row100:hover td {
            color: #fe3e64;
        }

        .table100.ver5 .hov-column-ver5 {
            color: #fe3e64;
        }

        .table100.ver5 .hov-column-ver5::before {
            content: "";
            display: block;
            position: absolute;
            width: 100%;
            height: 100%;
            top: 0;
            left: 0;
            pointer-events: none;
            border-left: 1px solid #f2f2f2;
            border-right: 1px solid #f2f2f2;
        }

        .table100.ver5 .hov-column-head-ver5 {
            background-color: #1a3f48;
            color: #fe3e64;
        }

        .table100.ver5 .row100 td:hover {
            color: #fe3e64;
        }

        .table100.ver5 .row100 td:hover:before {
            content: "";
            display: block;
            position: absolute;
            width: 100%;
            height: 100%;
            top: 0;
            left: 0;
            pointer-events: none;
            border: 1px solid #fe3e64;
        }

        /*==================================================================
[ Ver6 ]*/

        .table100.ver6 {
            border-radius: 16px;
            overflow: hidden;
            background: #7918f2;
            background: -webkit-linear-gradient(-68deg, #ac32e4, #4801ff);
            background: -o-linear-gradient(-68deg, #ac32e4, #4801ff);
            background: -moz-linear-gradient(-68deg, #ac32e4, #4801ff);
            background: linear-gradient(-68deg, #ac32e4, #4801ff);
        }

        .table100.ver6 table {
            background-color: transparent;
        }

        .table100.ver6 td {
            font-family: 'Montserrat', sans-serif;
            font-weight: 400;
            font-size: 14px;
            color: #fff;
            line-height: 1.4;
        }

        .table100.ver6 th {
            font-family: 'Montserrat', sans-serif;
            font-weight: 500;
            font-size: 12px;
            color: #fff;
            line-height: 1.4;
            text-transform: uppercase;

            background-color: rgba(255, 255, 255, 0.32);
        }

        .table100.ver6 .row100:hover td {
            background-color: rgba(255, 255, 255, 0.1);
        }

        .table100.ver6 .hov-column-ver6 {
            background-color: rgba(255, 255, 255, 0.1);
        }


        .table100.ver6 .row100 td:hover {
            background-color: rgba(255, 255, 255, 0.2);
        }

        #map {
            height: 100%
        }

        .alert {
            display: none;
        }

        .buttons .selected {
            color: red;
        }

        /* 
        label {
            display: block;
        } */

        /*-------- Custom CSS--------*/
        .selection-form,
        .actionbtn,
        .select-place,
        .tabbable {
            margin: 0 auto;
            width: 100%;
        }

        .col-auto {
            display: inline-block;
            width: 24%;
        }

        .input-group-sm>.input-group-prepend>.input-group-text {
            line-height: 2.5;
        }

        .multiselect-container>li>a>label {
            padding: 3px 15px !important;
        }

        .customer .card .card-body .btn,
        .map-container {
            margin-top: 20px;
        }

        ul#shipperlist {
            padding-left: 0;
        }

        .selection-form .row,
        .actionbtn .row,
        .select-place .row {
            margin: 0 auto;
        }

        a label.checkbox,
        a label.radio {
            color: #3a3a3a;
        }

        button.multiselect.dropdown-toggle.btn.btn-default {
            border: 1px solid #dedede;
        }

        .actionbtn {
            margin: 15px;
            display: inline;
        }

        .customer .btn-group .multiselect {
            text-align: left;
        }

        .card-text.date-card {
            position: relative;
        }

        input#time {
            width: 100%;
            padding: 10px;
        }

        .date-card i {
            position: absolute;
            right: 15px;
            top: 13px;
            color: #000;
            font-size: 20px;
        }


        button.multiselect.dropdown-toggle.btn.btn-default {
            background: none;
            text-align: left;
        }

        input.form-control.multiselect-search {
            margin-right: 10px;
        }

        button.btn.btn-default.multiselect-clear-filter {
            display: none;
        }

        .selection-form .multiselect-container.dropdown-menu.show {
            width: 20vw;
        }

        .select-place ul.multiselect-container.dropdown-menu {
            width: 17vw;
        }

        input#customRange2 {
            margin: 8px 15px;
        }

        .run-btn,
        .week-slider,
        .slider-btn {
            display: inline;
        }

        .week-slider label.form-label {
            display: inline;
            margin: 8px 15px;
        }

        .week-slider #start,
        .week-slider #stop {
            margin-left: 10px;
        }

        .select-place,
        .nav-tabs {
            margin-top: 15px;
        }


        .slider-btn button {
            background: #fff;
            border: none;
            cursor: pointer;
            margin-left: 10px;
        }

        select#customer-select,
        select#shipper-select,
        select#receiver-select,
        select#origin-state-select,
        select#origin-city-select,
        select#destination-city-select,
        select#destination-state-select {
            height: 38px;
        }

        .container-fluid {
            padding: 0 85px;
        }

        ul.multiselect-container.dropdown-menu.show {
            padding: 10px;
        }

        label.checkbox {
            text-indent: -15px;
        }

        .geo-block {
            width: 100%;
            background-clip: border-box;
            border: 1px solid rgba(0, 0, 0, .125);
            border-radius: .25rem;
            /* position: relative; */
        }

        .block-header {
            padding: .75rem 1.25rem;
            margin-bottom: 0;
            background-color: rgba(0, 0, 0, .03);
            border-bottom: 1px solid rgba(0, 0, 0, .125);
        }

        .block-body {
            padding: 1.5rem;
            display: flex;
        }

        .select-place .btn-group {
            margin-right: 10px;
        }

        .block-title {
            margin-bottom: .75rem;
        }

        .run-btn,
        .week-slider,
        .slider-btn,
        .nodata-alert {
            display: inline-block;
        }

        .week-slider .h6 {
            display: inline;
            margin-right: 10px;
        }

        #spinner {
            color: #002933;
            left: 47%;
            position: fixed;
            top: 47%;
            visibility: hidden;
            z-index: 1;
        }
        .loader {
            border: 16px solid #f3f3f3;
            /* Light grey */
            border-top: 16px solid #3498db;
            /* Blue */
            border-radius: 50%;
            width: 120px;
            height: 120px;
            animation: spin 2s linear infinite;
            margin: 0 auto;
            margin-top: 25px;
        }
        .sidechart {
            height: 100%;
            width: 0;
            position: fixed;
            z-index: 1001;
            top: 0;
            right: 0;
            overflow-x: hidden;
            transition: 0.5s;
            padding-top: 60px;
            background-color: white;
        }

        .sidechart a {
            padding: 8px 8px 8px 32px;
            text-decoration: none;
            font-size: 25px;
            color: #818181;
            display: block;
            transition: 0.3s;
        }

        .sidechart a:hover {
            color: #2b2b2b;
        }

        .sidechart .closebtn {
            position: absolute;
            top: 0;
            right: 25px;
            font-size: 36px;
            margin-left: 50px;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
    </style>
<style>
.info {
    padding: 6px 8px;
    font: 14px/16px Arial, Helvetica, sans-serif;
    background: white;
    background: rgba(255,255,255,0.8);
    box-shadow: 0 0 15px rgba(0,0,0,0.2);
    border-radius: 5px;
}
.info h4 {
    margin: 0 0 5px;
    color: #777;
}
    .legend {
    line-height: 18px;
    color: #555;
}
.legend i {
    width: 18px;
    height: 18px;
    float: left;
    margin-right: 8px;
    opacity: 0.7;
}
</style>
</head>

<body>
    <div class="container-fluid">
        <div class="card w-100">
            <div class="card-body">
                <div class="row">
                    <div class="select-place w-100">
                        <div class="col-auto o-state">
                            <!-- <div class="card-title">Origin State</div> -->
                            <select class="custom-select" name="Select Origin_State[]" id="origin-state-select" onChange="generateReversePopulate()"
                                multiple>
                                {% for items in origin_st %}
                                <option value="{{items}}">{{items}}</option>
                                {% endfor %}
                            </select>
                        </div>
                        <div class="col-auto o-city">
                            <!-- <div class="card-title">Origin City</div> -->
                            <select class="custom-select" name="Select Origin_City[]" id="origin-city-select" onChange="generateReversePopulate()" multiple>
                                {% for items in origin_ct %}
                                <option value="{{items}}">{{items}}</option>
                                {% endfor %}                            
                            </select>
                        </div>
                        <div class="col-auto o-city">
                            <select id="going-select" class="custom-select select-miles" aria-label="Select Incoming/Outgoing Trucks">
                                <option value="in">Incoming</option>
                                <option value="out">Outgoing</option>
                              </select>
                        </div>
                        <div class="col-auto o-city">
                            <select class="custom-select select-miles" id="miles">
                                <option value="50">50 Miles</option>
                                <option value="100">100 Mile</option>
                                <option value="150">150 Miles</option>
                                <option value="200">200 Miles</option>
                                <option value="300">300 Miles</option>
                                <option value="500">500 Miles</option>
                            </select>
                        </div>

                    </div>
                </div>

                <div class="row">
                    <div class="selection-form w-100">
                        <div class="col-auto customer">
                            <!-- <label class="card-title">Customer</label> -->
                            <select class="custom-select" name="Select Customer[]" id="customer-select" multiple>
                                <option class="disabled" disabled value>Select Carrier </option>
                            </select>
                        </div>
                        <div class="col-auto date-slider" id="date-range">
                            <!-- <label class="card-title">Date</label> -->
                            <div class="card-text date-card">
                                <input id="time" class="form-control pull-right" type="text" name="daterange" />
                                <i class="far fa-calendar-alt"></i>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="row">
                    <div class="actionbtn w-100">
                        <div class="run-btn">
                            <button type="button" class="btn btn-primary mb-2 mr-2" id="generate"
                                onclick="runHex()">Run</button>
                        </div>
                        <div id="weekSlider" class="week-slider d-none">
                            <label for="customRange2" class="card-title">Week Slider</label>
                            <div class="slider-btn">
                                <button type="button" class="fa fa-backward" aria-hidden="true" id="backward"
                                ></button>
                                <button id="start"><i class="fa fa-play" aria-hidden="true"></i>
                                </button>
                                <button id="stop"><i class="fa fa-stop" aria-hidden="true"></i>
                                </button>
                                <button type="button" class="fa fa-forward" aria-hidden="true" id="forward"
                                ></button>
                                <input type="range" class="form-range" min="1" max="20" step="1" id="customRange2"
                                    onChange="createMapArc()"></div>
                            <div class="h6" id="p1"></div>
                        </div>
                        <div class="nodata-alert">
                            <div class="alert alert-danger" role="alert" style="display:none;">
                                No Data Available for the selected Date Range.
                            </div>
                        </div>
                    </div> 
                </div>
            </div>
        </div>

        <div>
            <div id="loaders" class="loader"></div>
        <div id="mapContainer" class="map-container row">
            <div class="tabbable boxed parentTabs">
                <ul class="nav nav-tabs">
                    <li class="active"><a href="#map-container" class="nav-link">Map</a></li>
                    <li><button class="m-2 btn-primary" onclick="refreshEverything()"><i class="fas fa-sync" aria-hidden="true"></i>
                    </button></li>
                </ul>
                <div class="tab-content">
                    <div class="tab-pane fade active in show" id="map-container">
                        <div class="tabbable">
                            <div class="card">
                                <div id="mapClass" class="row">
                                    <div class="col-md-12">
                                        <div class="card-body">
                                            <div class="card-text">
                                                <div id="map" style="height: 908;"></div>
                                            </div>
                                        </div>
                                        <div id="sidechart" class="sidechart">
                                            <a href="javascript:void(0)" class="closebtn" onclick="closeChart()">&times;</a>
                                            <ul class="nav nav-tabs">
                                                <li class="active"><a data-toggle="tab" href="#menu4">Locations</a></li>
                                                <li><a data-toggle="tab" href="#menu2">Equipment</a></li>
                                                <li><a data-toggle="tab" href="#home">Carrier(Bar)</a></li>
                                                <li><a data-toggle="tab" href="#menu1">Carrier(Line)</a></li>
                                                <li><a data-toggle="tab" href="#menu3">Carrier[RealTime]</a></li>
                                            </ul>
    
                                            <div class="tab-content">
                                                <div id="home" class="tab-pane fade">
                                                    <div id="retreat" style="height: 500px;">
                                                    </div>
                                                </div>
                                                <div id="menu1" class="tab-pane fade">
                                                    <div id="heal" style="height:480;">
                                                        <canvas id="myChart1"></canvas>
                                                    </div>
                                                </div>
                                                <div id="menu2" class="tab-pane fade">
                                                    <div id="command" style="height: 500px;">
                                                    </div>
                                                </div>
                                                <div id="menu3" class="tab-pane fade">
                                                    <div id="plan" style="height: 500px;">
                                                    </div>
                                                </div>
                                                <div id="menu4" class="tab-pane fade in active show">
                                                    <div id="strategy" style="height: 500px;">
                                                    </div>
                                                </div>
                                                <div id="sheild" style="height: 500px;">
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        </div>

    </div>


    <!-- <script src="http://cdn.leafletjs.com/leaflet-0.7.2/leaflet.js"></script> -->
    <script src="https://unpkg.com/leaflet@1.7.1/dist/leaflet.js"></script>
    <script src="https://code.jquery.com/jquery-1.9.1.min.js"></script>
    <script src="https://code.jquery.com/ui/1.12.1/jquery-ui.js"
        integrity="sha256-T0Vest3yCU7pafRw9r+settMBX6JkKN06dqBnpQ8d30=" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.9/umd/popper.min.js"
        integrity="sha384-ApNbgh9B+Y1QKtv3Rn7W3mgPxhU9K/ScQsAP7hUibX39j7fakFPskvXusvfa0b4Q" crossorigin="anonymous">
    </script>

    <!-- Include this library for mobile touch support  -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jqueryui-touch-punch/0.2.2/jquery.ui.touch-punch.min.js">
    </script>

    <script type="text/javascript" src="https://cdn.jsdelivr.net/momentjs/latest/moment.min.js"></script>
    <script type="text/javascript" src="https://cdn.jsdelivr.net/npm/daterangepicker/daterangepicker.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/js/bootstrap.min.js"
        integrity="sha384-JZR6Spejh4U02d8jOt6vLEHfe/JQGiRRSQQxSfFWpi1MquVdAyjUar5+76PVCmYl" crossorigin="anonymous">
    </script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/2.9.2/umd/popper.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-multiselect/0.9.16/js/bootstrap-multiselect.min.js">
    </script>
    <script src='https://cdnjs.cloudflare.com/ajax/libs/chroma-js/2.1.0/chroma.min.js'></script>
    <script src='https://cdnjs.cloudflare.com/ajax/libs/leaflet.heat/0.2.0/leaflet-heat.js'></script>
    <script src="{% static 'js/leaflet.polylineDecorator.js' %}"></script>
    <script src="https://cdn.jsdelivr.net/npm/leaflet-ant-path@1.3.0/dist/leaflet-ant-path.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-multiselect/0.9.13/js/bootstrap-multiselect.js">
    </script>
    <script src="https://cdn.jsdelivr.net/npm/apexcharts"></script>
    <script src="https://kit.fontawesome.com/3dea19e7ad.js" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/d3/6.7.0/d3.min.js"></script>
    <script src="https://d3js.org/d3.v3.min.js"></script>
    <script src="https://rawgit.com/jasondavies/d3-cloud/master/build/d3.layout.cloud.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <!-- Load d3.js -->
    <script src="https://d3js.org/d3.v4.js"></script>

    <!-- Load d3-cloud -->
    <script src="https://cdn.jsdelivr.net/gh/holtzy/D3-graph-gallery@master/LIB/d3.layout.cloud.js"></script>
    <script src="https://cdn.amcharts.com/lib/4/core.js"></script>
    <script src="https://cdn.amcharts.com/lib/4/charts.js"></script>
    <script src="https://cdn.amcharts.com/lib/4/plugins/wordCloud.js"></script>
    <script src="https://cdn.amcharts.com/lib/4/themes/dataviz.js"></script>
    <script src="https://cdn.amcharts.com/lib/4/themes/kelly.js"></script>
    <script src="https://cdn.amcharts.com/lib/4/themes/frozen.js"></script>
    <script src="https://cdn.amcharts.com/lib/4/themes/animated.js"></script>


<script>
    (function (global, factory) {
    typeof exports === 'object' && typeof module !== 'undefined' ? factory(require('leaflet')) :
    typeof define === 'function' && define.amd ? define(['leaflet'], factory) :
    (factory(global.L));
}(this, (function (L$1) { 'use strict';

L$1 = L$1 && L$1.hasOwnProperty('default') ? L$1['default'] : L$1;

// functional re-impl of L.Point.distanceTo,
// with no dependency on Leaflet for easier testing
function pointDistance(ptA, ptB) {
    var x = ptB.x - ptA.x;
    var y = ptB.y - ptA.y;
    return Math.sqrt(x * x + y * y);
}

var computeSegmentHeading = function computeSegmentHeading(a, b) {
    return (Math.atan2(b.y - a.y, b.x - a.x) * 180 / Math.PI + 90 + 360) % 360;
};

var asRatioToPathLength = function asRatioToPathLength(_ref, totalPathLength) {
    var value = _ref.value,
        isInPixels = _ref.isInPixels;
    return isInPixels ? value / totalPathLength : value;
};

function parseRelativeOrAbsoluteValue(value) {
    if (typeof value === 'string' && value.indexOf('%') !== -1) {
        return {
            value: parseFloat(value) / 100,
            isInPixels: false
        };
    }
    var parsedValue = value ? parseFloat(value) : 0;
    return {
        value: parsedValue,
        isInPixels: parsedValue > 0
    };
}

var pointsEqual = function pointsEqual(a, b) {
    return a.x === b.x && a.y === b.y;
};

function pointsToSegments(pts) {
    return pts.reduce(function (segments, b, idx, points) {
        // this test skips same adjacent points
        if (idx > 0 && !pointsEqual(b, points[idx - 1])) {
            var a = points[idx - 1];
            var distA = segments.length > 0 ? segments[segments.length - 1].distB : 0;
            var distAB = pointDistance(a, b);
            segments.push({
                a: a,
                b: b,
                distA: distA,
                distB: distA + distAB,
                heading: computeSegmentHeading(a, b)
            });
        }
        return segments;
    }, []);
}

function projectPatternOnPointPath(pts, pattern) {
    // 1. split the path into segment infos
    var segments = pointsToSegments(pts);
    var nbSegments = segments.length;
    if (nbSegments === 0) {
        return [];
    }

    var totalPathLength = segments[nbSegments - 1].distB;

    var offset = asRatioToPathLength(pattern.offset, totalPathLength);
    var endOffset = asRatioToPathLength(pattern.endOffset, totalPathLength);
    var repeat = asRatioToPathLength(pattern.repeat, totalPathLength);

    var repeatIntervalPixels = totalPathLength * repeat;
    var startOffsetPixels = offset > 0 ? totalPathLength * offset : 0;
    var endOffsetPixels = endOffset > 0 ? totalPathLength * endOffset : 0;

    // 2. generate the positions of the pattern as offsets from the path start
    var positionOffsets = [];
    var positionOffset = startOffsetPixels;
    do {
        positionOffsets.push(positionOffset);
        positionOffset += repeatIntervalPixels;
    } while (repeatIntervalPixels > 0 && positionOffset < totalPathLength - endOffsetPixels);

    // 3. projects offsets to segments
    var segmentIndex = 0;
    var segment = segments[0];
    return positionOffsets.map(function (positionOffset) {
        // find the segment matching the offset,
        // starting from the previous one as offsets are ordered
        while (positionOffset > segment.distB && segmentIndex < nbSegments - 1) {
            segmentIndex++;
            segment = segments[segmentIndex];
        }

        var segmentRatio = (positionOffset - segment.distA) / (segment.distB - segment.distA);
        return {
            pt: interpolateBetweenPoints(segment.a, segment.b, segmentRatio),
            heading: segment.heading
        };
    });
}

/**
* Finds the point which lies on the segment defined by points A and B,
* at the given ratio of the distance from A to B, by linear interpolation.
*/
function interpolateBetweenPoints(ptA, ptB, ratio) {
    if (ptB.x !== ptA.x) {
        return {
            x: ptA.x + ratio * (ptB.x - ptA.x),
            y: ptA.y + ratio * (ptB.y - ptA.y)
        };
    }
    // special case where points lie on the same vertical axis
    return {
        x: ptA.x,
        y: ptA.y + (ptB.y - ptA.y) * ratio
    };
}

(function() {
    // save these original methods before they are overwritten
    var proto_initIcon = L.Marker.prototype._initIcon;
    var proto_setPos = L.Marker.prototype._setPos;

    var oldIE = (L.DomUtil.TRANSFORM === 'msTransform');

    L.Marker.addInitHook(function () {
        var iconOptions = this.options.icon && this.options.icon.options;
        var iconAnchor = iconOptions && this.options.icon.options.iconAnchor;
        if (iconAnchor) {
            iconAnchor = (iconAnchor[0] + 'px ' + iconAnchor[1] + 'px');
        }
        this.options.rotationOrigin = this.options.rotationOrigin || iconAnchor || 'center bottom' ;
        this.options.rotationAngle = this.options.rotationAngle || 0;

        // Ensure marker keeps rotated during dragging
        this.on('drag', function(e) { e.target._applyRotation(); });
    });

    L.Marker.include({
        _initIcon: function() {
            proto_initIcon.call(this);
        },

        _setPos: function (pos) {
            proto_setPos.call(this, pos);
            this._applyRotation();
        },

        _applyRotation: function () {
            if(this.options.rotationAngle) {
                this._icon.style[L.DomUtil.TRANSFORM+'Origin'] = this.options.rotationOrigin;

                if(oldIE) {
                    // for IE 9, use the 2D rotation
                    this._icon.style[L.DomUtil.TRANSFORM] = 'rotate(' + this.options.rotationAngle + 'deg)';
                } else {
                    // for modern browsers, prefer the 3D accelerated version
                    this._icon.style[L.DomUtil.TRANSFORM] += ' rotateZ(' + this.options.rotationAngle + 'deg)';
                }
            }
        },

        setRotationAngle: function(angle) {
            this.options.rotationAngle = angle;
            this.update();
            return this;
        },

        setRotationOrigin: function(origin) {
            this.options.rotationOrigin = origin;
            this.update();
            return this;
        }
    });
})();

L$1.Symbol = L$1.Symbol || {};

/**
* A simple dash symbol, drawn as a Polyline.
* Can also be used for dots, if 'pixelSize' option is given the 0 value.
*/
L$1.Symbol.Dash = L$1.Class.extend({
    options: {
        pixelSize: 10,
        pathOptions: {}
    },

    initialize: function initialize(options) {
        L$1.Util.setOptions(this, options);
        this.options.pathOptions.clickable = false;
    },

    buildSymbol: function buildSymbol(dirPoint, latLngs, map, index, total) {
        var opts = this.options;
        var d2r = Math.PI / 180;

        // for a dot, nothing more to compute
        if (opts.pixelSize <= 1) {
            return L$1.polyline([dirPoint.latLng, dirPoint.latLng], opts.pathOptions);
        }

        var midPoint = map.project(dirPoint.latLng);
        var angle = -(dirPoint.heading - 90) * d2r;
        var a = L$1.point(midPoint.x + opts.pixelSize * Math.cos(angle + Math.PI) / 2, midPoint.y + opts.pixelSize * Math.sin(angle) / 2);
        // compute second point by central symmetry to avoid unecessary cos/sin
        var b = midPoint.add(midPoint.subtract(a));
        return L$1.polyline([map.unproject(a), map.unproject(b)], opts.pathOptions);
    }
});

L$1.Symbol.dash = function (options) {
    return new L$1.Symbol.Dash(options);
};

L$1.Symbol.ArrowHead = L$1.Class.extend({
    options: {
        polygon: true,
        pixelSize: 10,
        headAngle: 60,
        pathOptions: {
            stroke: false,
            weight: 2
        }
    },

    initialize: function initialize(options) {
        L$1.Util.setOptions(this, options);
        this.options.pathOptions.clickable = false;
    },

    buildSymbol: function buildSymbol(dirPoint, latLngs, map, index, total) {
        return this.options.polygon ? L$1.polygon(this._buildArrowPath(dirPoint, map), this.options.pathOptions) : L$1.polyline(this._buildArrowPath(dirPoint, map), this.options.pathOptions);
    },

    _buildArrowPath: function _buildArrowPath(dirPoint, map) {
        var d2r = Math.PI / 180;
        var tipPoint = map.project(dirPoint.latLng);
        var direction = -(dirPoint.heading - 90) * d2r;
        var radianArrowAngle = this.options.headAngle / 2 * d2r;

        var headAngle1 = direction + radianArrowAngle;
        var headAngle2 = direction - radianArrowAngle;
        var arrowHead1 = L$1.point(tipPoint.x - this.options.pixelSize * Math.cos(headAngle1), tipPoint.y + this.options.pixelSize * Math.sin(headAngle1));
        var arrowHead2 = L$1.point(tipPoint.x - this.options.pixelSize * Math.cos(headAngle2), tipPoint.y + this.options.pixelSize * Math.sin(headAngle2));

        return [map.unproject(arrowHead1), dirPoint.latLng, map.unproject(arrowHead2)];
    }
});

L$1.Symbol.arrowHead = function (options) {
    return new L$1.Symbol.ArrowHead(options);
};

L$1.Symbol.Marker = L$1.Class.extend({
    options: {
        markerOptions: {},
        rotate: false
    },

    initialize: function initialize(options) {
        L$1.Util.setOptions(this, options);
        this.options.markerOptions.clickable = false;
        this.options.markerOptions.draggable = false;
    },

    buildSymbol: function buildSymbol(directionPoint, latLngs, map, index, total) {
        if (this.options.rotate) {
            this.options.markerOptions.rotationAngle = directionPoint.heading + (this.options.angleCorrection || 0);
        }
        return L$1.marker(directionPoint.latLng, this.options.markerOptions);
    }
});

L$1.Symbol.marker = function (options) {
    return new L$1.Symbol.Marker(options);
};

var isCoord = function isCoord(c) {
    return c instanceof L$1.LatLng || Array.isArray(c) && c.length === 2 && typeof c[0] === 'number';
};

var isCoordArray = function isCoordArray(ll) {
    return Array.isArray(ll) && isCoord(ll[0]);
};

L$1.PolylineDecorator = L$1.FeatureGroup.extend({
    options: {
        patterns: []
    },

    initialize: function initialize(paths, options) {
        L$1.FeatureGroup.prototype.initialize.call(this);
        L$1.Util.setOptions(this, options);
        this._map = null;
        this._paths = this._initPaths(paths);
        this._bounds = this._initBounds();
        this._patterns = this._initPatterns(this.options.patterns);
    },

    /**
    * Deals with all the different cases. input can be one of these types:
    * array of LatLng, array of 2-number arrays, Polyline, Polygon,
    * array of one of the previous.
    */
    _initPaths: function _initPaths(input, isPolygon) {
        var _this = this;

        if (isCoordArray(input)) {
            // Leaflet Polygons don't need the first point to be repeated, but we do
            var coords = isPolygon ? input.concat([input[0]]) : input;
            return [coords];
        }
        if (input instanceof L$1.Polyline) {
            // we need some recursivity to support multi-poly*
            return this._initPaths(input.getLatLngs(), input instanceof L$1.Polygon);
        }
        if (Array.isArray(input)) {
            // flatten everything, we just need coordinate lists to apply patterns
            return input.reduce(function (flatArray, p) {
                return flatArray.concat(_this._initPaths(p, isPolygon));
            }, []);
        }
        return [];
    },

    // parse pattern definitions and precompute some values
    _initPatterns: function _initPatterns(patternDefs) {
        return patternDefs.map(this._parsePatternDef);
    },

    /**
    * Changes the patterns used by this decorator
    * and redraws the new one.
    */
    setPatterns: function setPatterns(patterns) {
        this.options.patterns = patterns;
        this._patterns = this._initPatterns(this.options.patterns);
        this.redraw();
    },

    /**
    * Changes the patterns used by this decorator
    * and redraws the new one.
    */
    setPaths: function setPaths(paths) {
        this._paths = this._initPaths(paths);
        this._bounds = this._initBounds();
        this.redraw();
    },

    /**
    * Parse the pattern definition
    */
    _parsePatternDef: function _parsePatternDef(patternDef, latLngs) {
        return {
            symbolFactory: patternDef.symbol,
            // Parse offset and repeat values, managing the two cases:
            // absolute (in pixels) or relative (in percentage of the polyline length)
            offset: parseRelativeOrAbsoluteValue(patternDef.offset),
            endOffset: parseRelativeOrAbsoluteValue(patternDef.endOffset),
            repeat: parseRelativeOrAbsoluteValue(patternDef.repeat)
        };
    },

    onAdd: function onAdd(map) {
        this._map = map;
        this._draw();
        this._map.on('moveend', this.redraw, this);
    },

    onRemove: function onRemove(map) {
        this._map.off('moveend', this.redraw, this);
        this._map = null;
        L$1.FeatureGroup.prototype.onRemove.call(this, map);
    },

    /**
    * As real pattern bounds depends on map zoom and bounds,
    * we just compute the total bounds of all paths decorated by this instance.
    */
    _initBounds: function _initBounds() {
        var allPathCoords = this._paths.reduce(function (acc, path) {
            return acc.concat(path);
        }, []);
        return L$1.latLngBounds(allPathCoords);
    },

    getBounds: function getBounds() {
        return this._bounds;
    },

    /**
    * Returns an array of ILayers object
    */
    _buildSymbols: function _buildSymbols(latLngs, symbolFactory, directionPoints) {
        var _this2 = this;

        return directionPoints.map(function (directionPoint, i) {
            return symbolFactory.buildSymbol(directionPoint, latLngs, _this2._map, i, directionPoints.length);
        });
    },

    /**
    * Compute pairs of LatLng and heading angle,
    * that define positions and directions of the symbols on the path
    */
    _getDirectionPoints: function _getDirectionPoints(latLngs, pattern) {
        var _this3 = this;

        if (latLngs.length < 2) {
            return [];
        }
        var pathAsPoints = latLngs.map(function (latLng) {
            return _this3._map.project(latLng);
        });
        return projectPatternOnPointPath(pathAsPoints, pattern).map(function (point) {
            return {
                latLng: _this3._map.unproject(L$1.point(point.pt)),
                heading: point.heading
            };
        });
    },

    redraw: function redraw() {
        if (!this._map) {
            return;
        }
        this.clearLayers();
        this._draw();
    },

    /**
    * Returns all symbols for a given pattern as an array of FeatureGroup
    */
    _getPatternLayers: function _getPatternLayers(pattern) {
        var _this4 = this;

        var mapBounds = this._map.getBounds().pad(0.1);
        return this._paths.map(function (path) {
            var directionPoints = _this4._getDirectionPoints(path, pattern)
            // filter out invisible points
            .filter(function (point) {
                return mapBounds.contains(point.latLng);
            });
            return L$1.featureGroup(_this4._buildSymbols(path, pattern.symbolFactory, directionPoints));
        });
    },

    /**
    * Draw all patterns
    */
    _draw: function _draw() {
        var _this5 = this;

        this._patterns.map(function (pattern) {
            return _this5._getPatternLayers(pattern);
        }).forEach(function (layers) {
            _this5.addLayer(L$1.featureGroup(layers));
        });
    }
});
/*
 * Allows compact syntax to be used
 */
L$1.polylineDecorator = function (paths, options) {
    return new L$1.PolylineDecorator(paths, options);
};

})));
</script>
    <script>
        L.Control.SliderControl = L.Control.extend({
            options: {
                position: 'topright',
                layers: null,
                timeAttribute: 'time',
                isEpoch: false, // whether the time attribute is seconds elapsed from epoch
                startTimeIdx: 0, // where to start looking for a timestring
                timeStrLength: 19, // the size of  yyyy-mm-dd hh:mm:ss - if millis are present this will be larger
                maxValue: -1,
                minValue: 0,
                showAllOnStart: false,
                markers: null,
                range: false,
                follow: false,
                sameDate: false,
                alwaysShowDate: false,
                rezoom: null
            },

            initialize: function (options) {
                L.Util.setOptions(this, options);
                this._layer = this.options.layer;

            },

            extractTimestamp: function (time, options) {
                if (options.isEpoch) {
                    time = (new Date(parseInt(time))).toString(); // this is local time
                }
                return time.substr(options.startTimeIdx, options.startTimeIdx + options.timeStrLength);
            },

            setPosition: function (position) {
                var map = this._map;

                if (map) {
                    map.removeControl(this);
                }

                this.options.position = position;

                if (map) {
                    map.addControl(this);
                }
                this.startSlider();
                return this;
            },

            onAdd: function (map) {
                this.options.map = map;

                // Create a control sliderContainer with a jquery ui slider
                var sliderContainer = L.DomUtil.create('div', 'slider', this._container);
                $(sliderContainer).append(
                    '<div id="leaflet-slider" style="width:200px"><div class="ui-slider-handle"></div><div id="slider-timestamp" style="width:200px; margin-top:13px; background-color:#FFFFFF; text-align:center; border-radius:5px;"></div></div>'
                );
                //Prevent map panning/zooming while using the slider
                $(sliderContainer).mousedown(function () {
                    map.dragging.disable();
                });
                $(document).mouseup(function () {
                    map.dragging.enable();
                    //Hide the slider timestamp if not range and option alwaysShowDate is set on false
                    if (options.range || !options.alwaysShowDate) {
                        $('#slider-timestamp').html('');
                    }
                });

                var options = this.options;
                this.options.markers = [];

                //If a layer has been provided: calculate the min and max values for the slider
                if (this._layer) {
                    var index_temp = 0;
                    this._layer.eachLayer(function (layer) {
                        options.markers[index_temp] = layer;
                        ++index_temp;
                    });
                    options.maxValue = index_temp - 1;
                    this.options = options;
                } else {
                    console.log(
                        "Error: You have to specify a layer via new SliderControl({layer: your_layer});"
                    );
                }
                return sliderContainer;
            },

            onRemove: function (map) {
                //Delete all markers which where added via the slider and remove the slider div
                for (i = this.options.minValue; i <= this.options.maxValue; i++) {
                    map.removeLayer(this.options.markers[i]);
                }
                $('#leaflet-slider').remove();

                // unbind listeners to prevent memory leaks
                $(document).off("mouseup");
                $(".slider").off("mousedown");
            },

            startSlider: function () {
                _options = this.options;
                _extractTimestamp = this.extractTimestamp
                var index_start = _options.minValue;
                if (_options.showAllOnStart) {
                    index_start = _options.maxValue;
                    if (_options.range) _options.values = [_options.minValue, _options.maxValue];
                    else _options.value = _options.maxValue;
                }
                $("#leaflet-slider").slider({
                    range: _options.range,
                    value: _options.value,
                    values: _options.values,
                    min: _options.minValue,
                    max: _options.maxValue,
                    sameDate: _options.sameDate,
                    step: 1,
                    slide: function (e, ui) {
                        var map = _options.map;
                        var fg = L.featureGroup();
                        if (!!_options.markers[ui.value]) {
                            // If there is no time property, this line has to be removed (or exchanged with a different property)
                            if (_options.markers[ui.value].feature !== undefined) {
                                if (_options.markers[ui.value].feature.properties[_options
                                        .timeAttribute]) {
                                    if (_options.markers[ui.value]) $('#slider-timestamp').html(
                                        _extractTimestamp(_options.markers[ui.value].feature
                                            .properties[_options.timeAttribute], _options));
                                } else {
                                    console.error("Time property " + _options.timeAttribute +
                                        " not found in data");
                                }
                            } else {
                                // set by leaflet Vector Layers
                                if (_options.markers[ui.value].options[_options
                                        .timeAttribute]) {
                                    if (_options.markers[ui.value]) $('#slider-timestamp').html(
                                        _extractTimestamp(_options.markers[ui.value]
                                            .options[_options.timeAttribute], _options));
                                } else {
                                    console.error("Time property " + _options.timeAttribute +
                                        " not found in data");
                                }
                            }

                            var i;
                            // clear markers
                            for (i = _options.minValue; i <= _options.maxValue; i++) {
                                if (_options.markers[i]) map.removeLayer(_options.markers[i]);
                            }
                            if (_options.range) {
                                // jquery ui using range
                                for (i = ui.values[0]; i <= ui.values[1]; i++) {
                                    if (_options.markers[i]) {
                                        map.addLayer(_options.markers[i]);
                                        fg.addLayer(_options.markers[i]);
                                    }
                                }
                            } else if (_options.follow) {
                                for (i = ui.value - _options.follow + 1; i <= ui.value; i++) {
                                    if (_options.markers[i]) {
                                        map.addLayer(_options.markers[i]);
                                        fg.addLayer(_options.markers[i]);
                                    }
                                }
                            } else if (_options.sameDate) {
                                var currentTime;
                                if (_options.markers[ui.value].feature !== undefined) {
                                    currentTime = _options.markers[ui.value].feature.properties
                                        .time;
                                } else {
                                    currentTime = _options.markers[ui.value].options.time;
                                }
                                for (i = _options.minValue; i <= _options.maxValue; i++) {
                                    if (_options.markers[i].options.time == currentTime) map
                                        .addLayer(_options.markers[i]);
                                }
                            } else {
                                for (i = _options.minValue; i <= ui.value; i++) {
                                    if (_options.markers[i]) {
                                        map.addLayer(_options.markers[i]);
                                        fg.addLayer(_options.markers[i]);
                                    }
                                }
                            }
                        };
                        if (_options.rezoom) {
                            map.fitBounds(fg.getBounds(), {
                                maxZoom: _options.rezoom
                            });
                        }
                    }
                });
                if (!_options.range && _options.alwaysShowDate) {
                    $('#slider-timestamp').html(_extractTimeStamp(_options.markers[index_start].feature
                        .properties[_options.timeAttribute], _options));
                }
                for (i = _options.minValue; i <= index_start; i++) {
                    _options.map.addLayer(_options.markers[i]);
                }
            }
        });

        L.control.sliderControl = function (options) {
            return new L.Control.SliderControl(options);
        };
    </script>
    <script>
        ///// FIXME: Use path._rings instead of path._latlngs???
        ///// FIXME: Panic if this._map doesn't exist when called.
        ///// FIXME: Implement snakeOut()
        ///// FIXME: Implement layerGroup.snakeIn() / Out()


        L.Polyline.include({

            // Hi-res timestamp indicating when the last calculations for vertices and
            // distance took place.
            _snakingTimestamp: 0,

            // How many rings and vertices we've already visited
            // Yeah, yeah, "rings" semantically only apply to polygons, but L.Polyline
            // internally uses that nomenclature.
            _snakingRings: 0,
            _snakingVertices: 0,

            // Distance to draw (in screen pixels) since the last vertex
            _snakingDistance: 0,

            // Flag
            _snaking: false,


            /// TODO: accept a 'map' parameter, fall back to addTo() in case
            /// performance.now is not available.
            snakeIn: function () {

                if (this._snaking) {
                    return;
                }

                if (!('performance' in window) ||
                    !('now' in window.performance) ||
                    !this._map) {
                    return;
                }

                this._snaking = true;
                this._snakingTime = performance.now();
                this._snakingVertices = this._snakingRings = this._snakingDistance = 0;

                if (!this._snakeLatLngs) {
                    this._snakeLatLngs = L.LineUtil.isFlat(this._latlngs) ? [this._latlngs] :
                        this._latlngs;
                }

                // Init with just the first (0th) vertex in a new ring
                // Twice because the first thing that this._snake is is chop the head.
                this._latlngs = [
                    [this._snakeLatLngs[0][0], this._snakeLatLngs[0][0]]
                ];

                this._update();
                this._snake();
                this.fire('snakestart');
                return this;
            },


            _snake: function () {

                var now = performance.now();
                var diff = now - this._snakingTime; // In milliseconds
                var forward = diff * this.options.snakingSpeed / 1000; // In pixels
                this._snakingTime = now;

                // Chop the head from the previous frame
                this._latlngs[this._snakingRings].pop();

                return this._snakeForward(forward);
            },

            _snakeForward: function (forward) {

                // If polyline has been removed from the map stop _snakeForward
                if (!this._map) return;
                // Calculate distance from current vertex to next vertex
                var currPoint = this._map.latLngToContainerPoint(
                    this._snakeLatLngs[this._snakingRings][this._snakingVertices]);
                var nextPoint = this._map.latLngToContainerPoint(
                    this._snakeLatLngs[this._snakingRings][this._snakingVertices + 1]);

                var distance = currPoint.distanceTo(nextPoint);

                // 		console.log('Distance to next point:', distance, '; Now at: ', this._snakingDistance, '; Must travel forward:', forward);
                // 		console.log('Vertices: ', this._latlngs);

                if (this._snakingDistance + forward > distance) {
                    // Jump to next vertex
                    this._snakingVertices++;
                    this._latlngs[this._snakingRings].push(this._snakeLatLngs[this._snakingRings][this
                        ._snakingVertices
                    ]);

                    if (this._snakingVertices >= this._snakeLatLngs[this._snakingRings].length - 1) {
                        if (this._snakingRings >= this._snakeLatLngs.length - 1) {
                            return this._snakeEnd();
                        } else {
                            this._snakingVertices = 0;
                            this._snakingRings++;
                            this._latlngs[this._snakingRings] = [
                                this._snakeLatLngs[this._snakingRings][this._snakingVertices]
                            ];
                        }
                    }

                    this._snakingDistance -= distance;
                    return this._snakeForward(forward);
                }

                this._snakingDistance += forward;

                var percent = this._snakingDistance / distance;

                var headPoint = nextPoint.multiplyBy(percent).add(
                    currPoint.multiplyBy(1 - percent)
                );

                // Put a new head in place.
                var headLatLng = this._map.containerPointToLatLng(headPoint);
                this._latlngs[this._snakingRings].push(headLatLng);

                this.setLatLngs(this._latlngs);
                this.fire('snake');
                L.Util.requestAnimFrame(this._snake, this);
            },

            _snakeEnd: function () {

                this.setLatLngs(this._snakeLatLngs);
                this._snaking = false;
                this.fire('snakeend');

            }

        });


        L.Polyline.mergeOptions({
            snakingSpeed: 200 // In pixels/sec
        });





        L.LayerGroup.include({

            _snakingLayers: [],
            _snakingLayersDone: 0,

            snakeIn: function () {

                if (!('performance' in window) ||
                    !('now' in window.performance) ||
                    !this._map ||
                    this._snaking) {
                    return;
                }

                this._snaking = true;
                this._snakingLayers = [];
                this._snakingLayersDone = 0;
                var keys = Object.keys(this._layers);
                for (var i in keys) {
                    var key = keys[i];
                    this._snakingLayers.push(this._layers[key]);
                }
                this.clearLayers();

                this.fire('snakestart');
                return this._snakeNext();
            },


            _snakeNext: function () {


                if (this._snakingLayersDone >= this._snakingLayers.length) {
                    this.fire('snakeend');
                    this._snaking = false;
                    return;
                }

                var currentLayer = this._snakingLayers[this._snakingLayersDone];

                this._snakingLayersDone++;

                this.addLayer(currentLayer);
                if ('snakeIn' in currentLayer) {
                    currentLayer.once('snakeend', function () {
                        setTimeout(this._snakeNext.bind(this), this.options.snakingPause);
                    }, this);
                    currentLayer.snakeIn();
                } else {
                    setTimeout(this._snakeNext.bind(this), this.options.snakingPause);
                }


                this.fire('snake');
                return this;
            }

        });

        L.LayerGroup.mergeOptions({
            snakingPause: 200
        });
    </script>
    <script type="text/javascript">
        $(document).ready(function () {
            $("ul.nav-tabs a").click(function (e) {
                e.preventDefault();
                $(this).tab('show');
            });
            $('#origin-state-select').multiselect({
                enableFiltering: true,
                includeSelectAllOption: true,
                selectAllJustVisible: false,
                enableCaseInsensitiveFiltering: true,
                selectedClass: "active multiselect-active-item-fallback",
                maxHeight: 300,
                buttonWidth: '20vw',
                nonSelectedText: 'Select State',
                filterPlaceholder: 'Search for State...',
                widthSynchronizationMode: 'ifPopupIsSmaller',
                delimiterText: '; ',
                buttonTextAlignment: 'left',
                templates: {
                    filter: '<div class="multiselect-filter"><div class="input-group input-group-sm p-1"><div class="input-group-prepend"><i class="input-group-text fas fa-search"></i></div><input class="form-control multiselect-search" type="text" /></div></div>',
                    button: '<button type="button" class="multiselect dropdown-toggle" data-toggle="dropdown"><span class="multiselect-selected-text"></span></button>',
                    popupContainer: '<div class="multiselect-container dropdown-menu"></div>',
                }
            });
            $('#origin-city-select').multiselect({
                enableFiltering: true,
                includeSelectAllOption: true,
                selectAllJustVisible: false,
                enableCaseInsensitiveFiltering: true,
                selectedClass: "active multiselect-active-item-fallback",
                maxHeight: 300,
                buttonWidth: '20vw',
                nonSelectedText: 'Select City',
                filterPlaceholder: 'Search for City...',
                widthSynchronizationMode: 'ifPopupIsSmaller',
                delimiterText: '; ',
                buttonTextAlignment: 'left',
                templates: {
                    filter: '<div class="multiselect-filter"><div class="input-group input-group-sm p-1"><div class="input-group-prepend"><i class="input-group-text fas fa-search"></i></div><input class="form-control multiselect-search" type="text" /></div></div>',
                    button: '<button type="button" class="multiselect dropdown-toggle" data-toggle="dropdown"><span class="multiselect-selected-text"></span></button>',
                    popupContainer: '<div class="multiselect-container dropdown-menu"></div>',
                }
            });
            $('#destination-state-select').multiselect({
                enableFiltering: true,
                includeSelectAllOption: true,
                selectAllJustVisible: false,
                enableCaseInsensitiveFiltering: true,
                selectedClass: "active multiselect-active-item-fallback",
                maxHeight: 300,
                buttonWidth: '20vw',
                nonSelectedText: 'Select Destination State',
                filterPlaceholder: 'Search for Destination State...',
                widthSynchronizationMode: 'ifPopupIsSmaller',
                delimiterText: '; ',
                buttonTextAlignment: 'left',
                templates: {
                    filter: '<div class="multiselect-filter"><div class="input-group input-group-sm p-1"><div class="input-group-prepend"><i class="input-group-text fas fa-search"></i></div><input class="form-control multiselect-search" type="text" /></div></div>',
                    button: '<button type="button" class="multiselect dropdown-toggle" data-toggle="dropdown"><span class="multiselect-selected-text"></span></button>',
                    popupContainer: '<div class="multiselect-container dropdown-menu"></div>',
                }
            });
            $('#destination-city-select').multiselect({
                enableFiltering: true,
                includeSelectAllOption: true,
                selectAllJustVisible: false,
                enableCaseInsensitiveFiltering: true,
                selectedClass: "active multiselect-active-item-fallback",
                maxHeight: 300,
                buttonWidth: '20vw',
                nonSelectedText: 'Select Destination City',
                filterPlaceholder: 'Search for Destination City...',
                widthSynchronizationMode: 'ifPopupIsSmaller',
                delimiterText: '; ',
                buttonTextAlignment: 'left',
                templates: {
                    filter: '<div class="multiselect-filter"><div class="input-group input-group-sm p-1"><div class="input-group-prepend"><i class="input-group-text fas fa-search"></i></div><input class="form-control multiselect-search" type="text" /></div></div>',
                    button: '<button type="button" class="multiselect dropdown-toggle" data-toggle="dropdown"><span class="multiselect-selected-text"></span></button>',
                    popupContainer: '<div class="multiselect-container dropdown-menu"></div>',
                }
            });
        });
    </script>
    <script>
        (function ($) {
            "use strict";
            $('.column100').on('mouseover', function () {
                var table1 = $(this).parent().parent().parent();
                var table2 = $(this).parent().parent();
                var verTable = $(table1).data('vertable') + "";
                var column = $(this).data('column') + "";

                $(table2).find("." + column).addClass('hov-column-' + verTable);
                $(table1).find(".row100.head ." + column).addClass('hov-column-head-' + verTable);
            });

            $('.column100').on('mouseout', function () {
                var table1 = $(this).parent().parent().parent();
                var table2 = $(this).parent().parent();
                var verTable = $(table1).data('vertable') + "";
                var column = $(this).data('column') + "";

                $(table2).find("." + column).removeClass('hov-column-' + verTable);
                $(table1).find(".row100.head ." + column).removeClass('hov-column-head-' + verTable);
            });

        })(jQuery);
    </script>

    <script>
        function getSimilarCustomer() {
            var customer_sim = document.getElementById("similar-select").value;
            var loads_val = document.getElementById("loads_range").value;
            var price_range = document.getElementById("price_range").value;
            var lanes_range = document.getElementById("lanes_range").value;
            var shippers_range = document.getElementById("shippers_range").value;
            $.ajax({
                url: "{% url 'similar_lanes' %}",
                type: "get", //send it through get method
                data: {
                    customer: customer_sim,
                    loads_val: loads_val,
                    price_range: price_range,
                    lanes_range: lanes_range,
                    shippers_range: shippers_range
                },
                success: function (response) {
                    if (!response.error[0]) {
                        $('.alert').hide();
                        var similar_customerz = response.data;
                        var loads = similar_customerz;
                        var tbodyRef = document.getElementById('similar_table').getElementsByTagName(
                            'tbody')[0];
                        // Insert a row at the end of table
                        tbodyRef.innerHTML = '';
                        var i;
                        for (i = 0; i < loads.length; i++) {
                            var newRow = tbodyRef.insertRow();
                            newRow.className = "row100";
                            newRow.innerHTML += '<td class="column100 column1" data-column="column1">' +
                                loads[i][0] + '</td>\
                              <td class="column100 column2" data-column="column2">' + loads[i][1] + '</td>\
                              <td class="column100 column3" data-column="column3">' + loads[i][2] + '</td>\
                              <td class="column100 column4" data-column="column4">' + loads[i][3] + '</td>';
                        }

                        // Object.entries(loads).forEach(([key, value]) => {
                        //   console.log(key, value);
                        // });

                    } else {
                        $('.alert').show();
                    }

                },
                error: function (xhr) {
                    //Do Something to handle error
                    console.log(xhr);
                }
            });

        }
    </script>

<script>

    //Simple animated example of d3-cloud - https://github.com/jasondavies/d3-cloud
    //Based on https://github.com/jasondavies/d3-cloud/blob/master/examples/simple.html

    // Encapsulate the word cloud functionality
    function wordCloud(selector) {

    var fill = d3.scale.category20();

    //Construct the word cloud's SVG element
    var svg = d3.select(selector).append("svg")
        .attr("width", 500)
        .attr("height", 500)
        .append("g")
        .attr("transform", "translate(250,250)");


    //Draw the word cloud
    function draw(words) {
        var cloud = svg.selectAll("g text")
                        .data(words, function(d) { return d.text; })

        //Entering words
        cloud.enter()
            .append("text")
            .style("font-family", "Impact")
            .style("fill", function(d, i) { return fill(i); })
            .attr("text-anchor", "middle")
            .attr('font-size', 1)
            .text(function(d) { return d.text; });

        //Entering and existing words
        cloud
            .transition()
                .duration(600)
                .style("font-size", function(d) { return d.size + "px"; })
                .attr("transform", function(d) {
                    return "translate(" + [d.x, d.y] + ")rotate(" + d.rotate + ")";
                })
                .style("fill-opacity", 1);

        //Exiting words
        cloud.exit()
            .transition()
                .duration(200)
                .style('fill-opacity', 1e-6)
                .attr('font-size', 1)
                .remove();
    }


    //Use the module pattern to encapsulate the visualisation code. We'll
    // expose only the parts that need to be public.
    return {

        //Recompute the word cloud for a new set of words. This method will
        // asycnhronously call draw when the layout has been computed.
        //The outside world will need to call this function, so make it part
        // of the wordCloud return value.
        update: function(words) {
            d3.layout.cloud().size([500, 500])
                .words(words)
                .padding(5)
                .rotate(function() { return ~~(Math.random() * 2) * 90; })
                .font("Impact")
                .fontSize(function(d) { return d.size; })
                .on("end", draw)
                .start();
        }
    }

    }

</script>

    <script>
        function closeChart() {
            document.getElementById('sidechart').style.width = "0";
        }
        var legend;
        document.getElementById('loaders').style.display = 'none';
        document.getElementById('mapContainer').style.display = 'block';
        var first = true;
        $(function () {
            $('input[name="daterange"]').daterangepicker({
                "showDropdowns": true,
                opens: 'left'
            }, function (start, end, label) {
                console.log("A new date selection was made: " + start.format('YYYY-MM-DD') + ' to ' +
                    end.format('YYYY-MM-DD'));
            });
        });

        var colors = [
            // "#ffffff",
            "#fcff94",
            "#f1a692",
            // "#fabe8c",
            "#e0769e",
            "#9a5caf",
            "#4b4ba5",
            // "#000000",
        ];
        var colorScale2_ = chroma.scale(colors).domain([0, 1]).mode('lab').correctLightness();

        var colorScale = function (value) {
            const color = colorScale2_(value);
            return color;
        };

        var sliderControl = null;

        var map = L.map('map').setView([30.663130, -101.668035], 5);

        // load a tile layer
        var mapbox = L.tileLayer('https://api.mapbox.com/styles/v1/{id}/tiles/{z}/{x}/{y}?access_token={accessToken}', {
            attribution: 'Map data  <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors, Imagery  <a href="https://www.mapbox.com/">Mapbox</a>',
            maxZoom: 16,
            id: 'mapbox/streets-v11',
            tileSize: 512,
            zoomOffset: -1,
            accessToken: 'pk.eyJ1IjoieXNmMTIzNzQiLCJhIjoiY2s4eTAzemw4MHJoMzNvbWl1a3FqY243NiJ9.0AwCckEj0uyhGaA8DhoQkw'
        }).addTo(map);
        map.scrollWheelZoom.disable();


        function generateReversePopulate() {
            var origin_st = $('#origin-state-select').val();
            var origin_ct = $('#origin-city-select').val();
            // var destination_st = $('#destination-state-select').val();
            // var destination_ct = $('#destination-city-select').val();
            var select1 = document.getElementById("customer-select");
            if (select1.options.length > 0) {
                while (select1.options.length > 0) {
                    select1.remove(0);
                }
            }

            $('#customer-select').multiselect({
                enableFiltering: true,
                includeSelectAllOption: true,
                selectAllJustVisible: false,
                enableCaseInsensitiveFiltering: true,
                selectedClass: "active multiselect-active-item-fallback",
                maxHeight: 280,
                buttonWidth: '20vw',
                nonSelectedText: 'Select a Carrier',
                filterPlaceholder: 'Search for Carrier...',
                widthSynchronizationMode: 'ifPopupIsSmaller',
                delimiterText: '; ',
                buttonTextAlignment: 'left',
                templates: {
                    filter: '<div class="multiselect-filter"><div class="input-group input-group-sm p-1"><div class="input-group-prepend"><i class="input-group-text fas fa-search"></i></div><input class="form-control multiselect-search" type="text" /></div></div>',
                    button: '<button type="button" class="multiselect dropdown-toggle" data-toggle="dropdown"><span class="multiselect-selected-text"></span></button>',
                    popupContainer: '<div class="multiselect-container dropdown-menu"></div>',
                }
            })
            $("#customer-select").multiselect("rebuild");

            $.ajax({
                url: "{% url 'just_map_carrier_api2' %}",
                type: "get",
                data: {
                    origin_st: origin_st,
                    origin_ct: origin_ct,
                    // destination_st: destination_st,
                    // destination_ct: destination_ct
                },
                success: function (response) {
                    var customer = response.customer;
                    select3 = document.getElementById("customer-select");
                    for (var k = 0; k < customer.length; k++) {
                        var option3 = document.createElement("option"),
                            txt = document.createTextNode(customer[k]);
                        option3.appendChild(txt);
                        option3.setAttribute("value", customer[k]);
                        select3.insertBefore(option3, select3.lastChild);
                    }
                    $('#customer-select').multiselect({
                        enableFiltering: true,
                        includeSelectAllOption: true,
                        selectAllJustVisible: false,
                        enableCaseInsensitiveFiltering: true,
                        selectedClass: "active multiselect-active-item-fallback",
                        maxHeight: 280,
                        buttonWidth: '20vw',
                        nonSelectedText: 'Select a Carrier',
                        filterPlaceholder: 'Search for Carrier...',
                        widthSynchronizationMode: 'ifPopupIsSmaller',
                        delimiterText: '; ',
                        buttonTextAlignment: 'left',
                        templates: {
                            filter: '<div class="multiselect-filter"><div class="input-group input-group-sm p-1"><div class="input-group-prepend"><i class="input-group-text fas fa-search"></i></div><input class="form-control multiselect-search" type="text" /></div></div>',
                            button: '<button type="button" class="multiselect dropdown-toggle" data-toggle="dropdown"><span class="multiselect-selected-text"></span></button>',
                            popupContainer: '<div class="multiselect-container dropdown-menu"></div>',
                        }
                    })
                    $("#customer-select").multiselect("rebuild");
                },
                error: function (xhr) {
                    console.log(xhr);
                }
            });
        }


        function clearMap() {
            for (i in map._layers) {
                try {
                    map.removeLayer(map._layers[i]);
                } catch (error) {
                    console.log(error);
                }
            }
        }

        var theMarker;
        var theCircle;
        var legend=null;
        var legend = L.control({position: 'topright'});
        function getColor(d) {
            return d > 80  ? '#00464E' :
                d > 72  ? '#491D8B' :
                d > 64   ? '#7B49BC' :
                d > 56   ? '#8A3FFC' :
                d > 48  ? '#BE95FF' :
                d > 40  ? '#E8DAFF' :
                d > 32  ? '#F6F2FF' :
                d > 24   ? '#D9FBFB' :
                d > 16   ? '#9EF0F0' :
                d > 8   ? '#3DDBD9' :
                d >= 1   ? '#009D9A' :
                            '#260000';
        }
        legend.onAdd = function (map) {

            var div = L.DomUtil.create('div', 'info legend'),
                grades = [1, 8, 16, 24, 32, 40, 48, 56, 64, 72, 80],
                labels = [];
            div.innerHTML +="<p>Trucks Count</p>";
            // loop through our density intervals and generate a label with a colored square for each interval
            for (var i = 0; i < grades.length; i++) {
                div.innerHTML +=
                    '<i style="background:' + getColor(grades[i] + 1) + '"></i> ' +
                    grades[i] + (grades[i + 1] ? '&ndash;' + grades[i + 1] + '<br>' : '+');
            }

            return div;
        };

    function runHex() {
        map.eachLayer(function (layer) {
            if (!layer._url) {
                map.removeLayer(layer);
            }

        });
        // try {
        //     legend.remove(map);
        // }
        // catch(err) {
        //     console.log("");
        // }

        legend.addTo(map);
        // var destination_st = $('#destination-state-select').val();
        var origin_st = $('#origin-state-select').val();
        var origin_ct = $('#origin-city-select').val();
        // var destination_ct = $('#destination-city-select').val();
        var going = document.getElementById("going-select").value;
        var time = document.getElementById("time").value;
        $.ajax({
                url: "{% url 'just_map_hexagons' %}",
                type: "get", //send it through get method
                data: {
                    origin_st: origin_st,
                    // destination_st: destination_st,
                    origin_ct: origin_ct,
                    // destination_ct: destination_ct,
                    times: time,
                    going: going
                },
                success: function (response) {

                var locations = response.feats;
                var layer = L.geoJson(false, {
                    onEachFeature: onEachFeature
                }).addTo(map);
                //   var layer = L.geoJson(false).addTo(map);
                function attivita_style (feature, layer) {
                        const color = feature.properties.color;
                        return {
                        "color":  color,
                        "fillColor":color,
                        "weight": 5,
                        "stroke":false,
                        "fillOpacity": 0.55
                        }
                    }
                // clearMap();
                // layer.clearLayers();
                layer.addData(locations).setStyle(attivita_style);

                },
                error: function (xhr) {
                    //Do Something to handle error
                    console.log(xhr);
                }
            });
    };

var highlight;
var style = {
  'default': {
    'color': 'yellow'
  },
  'highlight': {
    'color': 'red'
  }
};
// var highlight;

// function setHighlight (layer) {
//   if (highlight) {
//     unsetHighlight(highlight);
//   }
//   layer.setStyle(style.highlight);
//   highlight = layer;
// }

// function unsetHighlight (layer) {
//   highlight = null;
//   layer.setStyle(style.default);
// }

function onEachFeature (feature, layer) {
    // layer.on('mouseover', function (e) {
    //     var popuptext = '<table style="width:100%">\
    //                 <tr>\
    //                     <th>Trucks-Delivery Date</th>\
    //                     <th>Trucks-Pickup Date</th>\
    //                     <th>Total Trucks</th>\
    //                 </tr>\
    //                 <tr>\
    //                     <td>' + feature.properties.delivery + '</td>\
    //                     <td>' + feature.properties.pickup + '</td>\
    //                     <td>' + feature.properties.pop + '</td>\
    //                 </tr>\
    //                 </table>';
    //   layer.bindPopup(popuptext);
    //   this.openPopup();
    //   });
      layer.on('click', function (e) {
        //   setHighlight(layer);
          var going = document.getElementById("going-select").value;
          document.getElementById('heal').innerHTML = '<canvas id="myChart1"></canvas>';
          document.getElementById('sheild').innerHTML = '';
          document.getElementById('command').innerHTML = '';
          document.getElementById('plan').innerHTML = '';
          document.getElementById('strategy').innerHTML = '';
          document.getElementById('retreat').innerHTML = '';
        $.ajax({
                url: "{% url 'just_map_tile_id' %}",
                type: "get", //send it through get method
                data: {tile_id: feature.properties.id,going:going},
                success: function (response) {
                document.getElementById('heal').innerHTML = '<canvas id="myChart1"></canvas>';
                document.getElementById('sheild').innerHTML = '';
                var myChart1 = response.myChart1;
                var wordsList = response.words;
                var amt_chart1 = response.amt_chart1;
                var amt_chart1_labels = response.amt_chart1_labels;
                var amt_chart2 = response.amt_chart2;
                var line_data = response.line_data;
                var chord_data = response.chord_data;
                var highlight_poly= response.highlight_poly;
                var myStyle = {
                    "color": "#ff7800",
                    "weight": 10,
                    "opacity": 0.85
                };
                try{
                    map.removeLayer(highlight);
                }
                catch (err){
                    console.log("line 2465",err)
                }
                highlight=L.geoJSON(highlight_poly, {
                    style: myStyle
                });
                highlight.addTo(map);
                const config = {
                        type: 'line',
                        data: myChart1,
                        options: {
                                bezierCurve: true,
                                display: false,
                                scales: {
                                        y: {
                                            suggestedMin: 0.0
                                        }
                                    },
                                responsive: true,
                                maintainAspectRatio: false,
                                plugins: {
                                legend: {
                                    position: 'top',
                                },
                                title: {
                                    display: true,
                                    text: e.target.options.origin + '->' + e.target.options.destination
                                }
                                }
                            },
                        };

                var myChart1 = new Chart(
                document.getElementById('myChart1'),
                config
                );

                var words = wordsList


am4core.ready(function() {
am4core.addLicense("ch-custom-attribution");

// Themes begin
am4core.useTheme(am4themes_animated);
// Themes end
var chart = am4core.create("sheild", am4plugins_wordCloud.WordCloud);
// chart.width = am4core.percent(100);
// chart.height = am4core.percent(100);
var series = chart.series.push(new am4plugins_wordCloud.WordCloudSeries());

series.accuracy = 4;
series.step = 15;
series.rotationThreshold = 0.7;
series.maxCount = 200;
series.minWordLength = 2;
series.labels.template.tooltipText = "{word}: {value}";
series.fontFamily = "Courier New";
series.maxFontSize = am4core.percent(30);
series.colors = new am4core.ColorSet();
series.text = wordsList;
}); // end am4core.ready()

am4core.ready(function() {
am4core.addLicense("ch-custom-attribution");

// Themes begin
am4core.useTheme(am4themes_kelly);
am4core.useTheme(am4themes_animated);
// Themes end
var chart = am4core.create("retreat", am4charts.XYChart);

chart.data = amt_chart1;
// Create axes
var categoryAxis = chart.xAxes.push(new am4charts.CategoryAxis());
categoryAxis.dataFields.category = "year";
categoryAxis.renderer.grid.template.location = 0;

var valueAxis = chart.yAxes.push(new am4charts.ValueAxis());
valueAxis.renderer.inside = true;
valueAxis.renderer.labels.template.disabled = true;
valueAxis.min = 0;

// Create series
function createSeries(field, name) {
  
  // Set up series
  var series = chart.series.push(new am4charts.ColumnSeries());
  series.name = name;
  series.dataFields.valueY = field;
  series.dataFields.categoryX = "year";
  series.sequencedInterpolation = true;
  
  // Make it stacked
  series.stacked = true;
  
  // Configure columns
  series.columns.template.width = am4core.percent(60);
  series.columns.template.tooltipText = "[bold]{name}[/]\n[font-size:14px]{categoryX}: {valueY}";
  
  // Add label
  var labelBullet = series.bullets.push(new am4charts.LabelBullet());
  labelBullet.label.text = "{valueY}";
  labelBullet.locationY = 0.5;
  labelBullet.label.hideOversized = true;
  
  return series;
}

for (let index in amt_chart1_labels) {
  createSeries(amt_chart1_labels[index], amt_chart1_labels[index]);
}

// Legend
chart.legend = new am4charts.Legend();
chart.legend.maxHeight = 75;
chart.legend.scrollable = true;
chart.legend.maxWidth = 300;

}); // end am4core.ready()

am4core.ready(function() {
am4core.addLicense("ch-custom-attribution");

// Themes begin
am4core.useTheme(am4themes_frozen);
am4core.useTheme(am4themes_animated);
// Themes end
var chart = am4core.create("command", am4charts.PieChart);
chart.hiddenState.properties.opacity = 0; // this creates initial fade-in

chart.data=amt_chart2;
chart.radius = am4core.percent(70);
chart.innerRadius = am4core.percent(40);
chart.startAngle = 180;
chart.endAngle = 360;  

var series = chart.series.push(new am4charts.PieSeries());
series.dataFields.value = "value";
series.dataFields.category = "equipment_type_id";

series.slices.template.cornerRadius = 10;
series.slices.template.innerCornerRadius = 7;
series.slices.template.draggable = true;
series.slices.template.inert = true;
series.alignLabels = false;

series.hiddenState.properties.startAngle = 90;
series.hiddenState.properties.endAngle = 90;

chart.legend = new am4charts.Legend();
chart.legend.maxHeight = 50;
chart.legend.scrollable = true;
chart.legend.maxWidth = 300;
}); // end am4core.ready()
am4core.ready(function() {
am4core.addLicense("ch-custom-attribution");
// Themes begin
am4core.useTheme(am4themes_animated);
// Themes end

// Create chart instance
var chart = am4core.create("plan", am4charts.XYChart);

// Create axes
var dateAxis = chart.xAxes.push(new am4charts.DateAxis());
var valueAxis = chart.yAxes.push(new am4charts.ValueAxis());


for (let index in line_data) {
  createSeries(line_data[index][0], line_data[index][1], line_data[index][2]);
}
// Create series
function createSeries(s, name, deet) {
  var series = chart.series.push(new am4charts.LineSeries());
  series.dataFields.valueY = "value" + s;
  series.dataFields.dateX = "date";
  series.name = name;

  var segment = series.segments.template;
  segment.interactionsEnabled = true;

  var hoverState = segment.states.create("hover");
  hoverState.properties.strokeWidth = 3;

  var dimmed = segment.states.create("dimmed");
  dimmed.properties.stroke = am4core.color("#dadada");

  segment.events.on("over", function(event) {
    processOver(event.target.parent.parent.parent);
  });

  segment.events.on("out", function(event) {
    processOut(event.target.parent.parent.parent);
  });

  var data = [];
  for (let index in deet) {
    var dataItem = { date: new Date(parseInt(deet[index].year), parseInt(deet[index].month), parseInt(deet[index].day)) };
    dataItem["value" + s] = parseInt(deet[index].value) ;
    data.push(dataItem);
  }

  series.data = data;
  return series;
}

chart.legend = new am4charts.Legend();
chart.legend.position = "bottom";
chart.legend.scrollable = true;
chart.legend.maxHeight = 75;
chart.legend.maxWidth = 300;
// setTimeout(function() {
//   chart.legend.markers.getIndex(0).opacity = 0.3;
// }, 3000)
chart.legend.markers.template.states.create("dimmed").properties.opacity = 0.3;
chart.legend.labels.template.states.create("dimmed").properties.opacity = 0.3;

chart.legend.itemContainers.template.events.on("over", function(event) {
  processOver(event.target.dataItem.dataContext);
})

chart.legend.itemContainers.template.events.on("out", function(event) {
  processOut(event.target.dataItem.dataContext);
})

function processOver(hoveredSeries) {
  hoveredSeries.toFront();

  hoveredSeries.segments.each(function(segment) {
    segment.setState("hover");
  })
  
  hoveredSeries.legendDataItem.marker.setState("default");
  hoveredSeries.legendDataItem.label.setState("default");

  chart.series.each(function(series) {
    if (series != hoveredSeries) {
      series.segments.each(function(segment) {
        segment.setState("dimmed");
      })
      series.bulletsContainer.setState("dimmed");
      series.legendDataItem.marker.setState("dimmed");
      series.legendDataItem.label.setState("dimmed");
    }
  });
}

function processOut() {
  chart.series.each(function(series) {
    series.segments.each(function(segment) {
      segment.setState("default");
    })
    series.bulletsContainer.setState("default");
    series.legendDataItem.marker.setState("default");
    series.legendDataItem.label.setState("default");
  });
}


}); // end am4core.ready()

am4core.ready(function() {

// Themes begin
am4core.useTheme(am4themes_animated);
// Themes end

var chart = am4core.create("strategy", am4charts.ChordDiagram);

// colors of main characters
chart.colors.saturation = 0.45;
chart.colors.step = 3;
var colors = {
    Rachel:chart.colors.next(),
    Monica:chart.colors.next(),
    Phoebe:chart.colors.next(),
    Ross:chart.colors.next(),
    Joey:chart.colors.next(),
    Chandler:chart.colors.next()
}

// data was provided by: https://www.reddit.com/user/notrudedude

chart.data = chord_data;

chart.dataFields.fromName = "from";
chart.dataFields.toName = "to";
chart.dataFields.value = "value";


chart.nodePadding = 0.5;
chart.minNodeSize = 0.01;
chart.startAngle = 80;
chart.endAngle = chart.startAngle + 360;
chart.sortBy = "value";
chart.fontSize = 10;

var nodeTemplate = chart.nodes.template;
nodeTemplate.readerTitle = "Click to show/hide or drag to rearrange";
nodeTemplate.showSystemTooltip = true;
nodeTemplate.propertyFields.fill = "color";
nodeTemplate.tooltipText = "{name}'s Trucks: {total}";

// when rolled over the node, make all the links rolled-over
nodeTemplate.events.on("over", function(event) {    
    var node = event.target;
    node.outgoingDataItems.each(function(dataItem) {
        if(dataItem.toNode){
            dataItem.link.isHover = true;
            dataItem.toNode.label.isHover = true;
        }
    })
    node.incomingDataItems.each(function(dataItem) {
        if(dataItem.fromNode){
            dataItem.link.isHover = true;
            dataItem.fromNode.label.isHover = true;
        }
    }) 

    node.label.isHover = true;   
})

// when rolled out from the node, make all the links rolled-out
nodeTemplate.events.on("out", function(event) {
    var node = event.target;
    node.outgoingDataItems.each(function(dataItem) {        
        if(dataItem.toNode){
            dataItem.link.isHover = false;                
            dataItem.toNode.label.isHover = false;
        }
    })
    node.incomingDataItems.each(function(dataItem) {
        if(dataItem.fromNode){
            dataItem.link.isHover = false;
           dataItem.fromNode.label.isHover = false;
        }
    })

    node.label.isHover = false;
})

var label = nodeTemplate.label;
label.relativeRotation = 90;

label.fillOpacity = 0.4;
let labelHS = label.states.create("hover");
labelHS.properties.fillOpacity = 1;

nodeTemplate.cursorOverStyle = am4core.MouseCursorStyle.pointer;


// link template
var linkTemplate = chart.links.template;
linkTemplate.strokeOpacity = 0;
linkTemplate.fillOpacity = 0.15;
linkTemplate.tooltipText = "{fromName} -> {toName}:{value.value}";

var hoverState = linkTemplate.states.create("hover");
hoverState.properties.fillOpacity = 0.7;
hoverState.properties.strokeOpacity = 0.7;


}); // end am4core.ready()


                },
                error: function (xhr) {
                    //Do Something to handle error
                    console.log(xhr);
                }
            });
        document.getElementById('sidechart').style.width =
                                    "500px";
      });
}


// $.ajax({
//     url: "{% url 'just_map_hexagons' %}",
//     type: "get", //send it through get method
//     success: function (response) {
//       var locations = response.feats;
//       var layer = L.geoJson(false, {
//           onEachFeature: onEachFeature
//       }).addTo(map);  
//     //   var layer = L.geoJson(false).addTo(map);
//       function attivita_style (feature, layer) {
//             const color = feature.properties.color;
//             return {
//             "color":  color,
//             "fillColor":color,
//             "weight": 5,
//             "stroke":false,
//             "fillOpacity": 0.55
//             }
//           }
//       // clearMap();
//       // layer.clearLayers();
//       layer.addData(locations).setStyle(attivita_style);
//     },
//     error: function (xhr) {
//         //Do Something to handle error
//         console.log(xhr);
//     }
// });


var theMarker;
var theCircle;

map.on('dblclick',function(e){  
    lat = e.latlng.lat;
    lon = e.latlng.lng;
    ProcessClick(lat,lon)
    });

function ProcessClick(lat,lon){
console.log("You clicked the map at LAT: "+ lat+" and LONG: "+lon );
    // //Clear existing marker, circle, and selected points if selecting new points
    // if (theCircle != undefined) {
    // map.removeLayer(theCircle);
    // };
    // if (theMarker != undefined) {
    //     map.removeLayer(theMarker);
    // };

    // map.eachLayer(function (layer) {
    //     console.log(layer);
    // });
//Add a marker to show where you clicked.
theMarker = L.marker([lat,lon]).addTo(map);  //Note: if lat/lon are strings then use parseFloat(lat), parseFloat(lon)
SelectPoints(lat,lon)

}


function SelectPoints(lat,lon){
var dist = document.getElementById("miles").value;
// var dist = '100';
xy = [lat,lon];  //center point of circle
var theRadius = parseInt(dist) * 1609.34  //1609.34 meters in a mile //dist is a string so it's convered to an Interger.
// draw circle to see the selection area
theCircle = L.circle(xy, theRadius , {   /// Number is in Meters
    color: 'orange',
    fillOpacity: 0,
    opacity: 1
}).addTo(map);
$.ajax({
        url: "{% url 'just_map_deadhead' %}",
        type: "get", //send it through get method
        data: { lat: lat, lon: lon, dist: dist} ,
        success: function(response) {
        map.eachLayer(function (layer) {
            if (!layer._url) {
                map.removeLayer(layer);
            }
            if(legend !== null) {
                legend.remove(map);
                }
        });
        var lines = response.lines;
        lines.forEach(function (item, index) {
          try {
            // app_id=bAF20VgD8WeKtvNvP8fW&
            $.ajax({
                    url: "https://router.hereapi.com/v8/routes?apiKey=G6Lcwnx4nDSTjcdeLiHXMKJZUJuQDCqKT-SYAWpqV_k&transportMode=car&origin="+item[0][0]+","+item[0][1]+"&destination="+item[1][0]+","+item[1][1]+"&return=summary",
                    type: "get", //send it through get method
                    success: function(response) {
                        var summary = response['routes'][0]['sections'][0]['summary'];
                        var distance = summary['length'];
                        distance=parseInt(distance)/1000;
                        distance=distance.toFixed(2);
                        distance= distance.toString();
                        var ETA = summary['duration'];
                        ETA=parseInt(ETA)/60;
                        ETA=parseInt(ETA)/60;
                        ETA=ETA.toFixed(2);
                        ETA= ETA.toString();
                        var line = L.polyline([[parseFloat(item[0][0]), parseFloat(item[0][1])],
                                    [parseFloat(item[1][0]), parseFloat(item[1][1])]
                                                        ], {
                                                            color: item[3],
                                                            vertices: 200,
                                                            weight: 3,//item[2],
                                                            opacity: 0.5
                                                            // snakingSpeed: 150
                                                        });
                        var arrowHead = L.polylineDecorator(line, {
                        patterns: [{
                                offset: '100%',
                                repeat: 0,
                                symbol: L.Symbol.arrowHead({
                                    pixelSize: 5,
                                    polygon: false,
                                    pathOptions: {
                                        color: item[3],
                                        stroke: true
                                    }
                                })
                            }]
                        });
                        arrowHead.addTo(map);
                        popUp = '<table style="width:100%">\
                                <tr>\
                                    <th>Driving Distance</th>\
                                    <th>Shortest Distance</th>\
                                    <th>Estimated Time of Arrival</th>\
                                </tr>\
                                <tr>\
                                    <td>' + distance + ' Km</td>\
                                    <td>' + item[4] + '</td>\
                                    <td>' + ETA + ' Hour(s)</td>\
                                </tr>\
                                </table>';
                                // <p>'+item[5]+'</p>';
                        line.bindTooltip(popUp);
                        line.addTo(map);
                    },
                    error: function(xhr) {
                        //Do Something to handle error
                        console.log(xhr);
                        var line = L.polyline([[parseFloat(item[0][0]), parseFloat(item[0][1])],
                                [parseFloat(item[1][0]), parseFloat(item[1][1])]
                                                    ], {
                                                        color: item[3],
                                                        vertices: 200,
                                                        weight: 3,//item[2],
                                                        opacity: 0.5
                                                        // snakingSpeed: 150
                                                    });
                        var arrowHead = L.polylineDecorator(line, {
                            patterns: [{
                                    offset: '100%',
                                    repeat: 0,
                                    symbol: L.Symbol.arrowHead({
                                        pixelSize: 5,
                                        polygon: false,
                                        pathOptions: {
                                            color: item[3],
                                            stroke: true
                                        }
                                    })
                                }]
                        });
                        arrowHead.addTo(map);
                        popUp = '<table style="width:100%">\
                                <tr>\
                                    <th>Driving Distance</th>\
                                    <th>Shortest Distance</th>\
                                    <th>Estimated Time of Arrival</th>\
                                </tr>\
                                <tr>\
                                    <td>' + item[4] + ' Km</td>\
                                    <td>' + item[4] + '</td>\
                                    <td> seconds</td>\
                                </tr>\
                                </table>';
                                // <p>'+item[5]+'</p>';
                        line.bindTooltip(popUp);
                        line.addTo(map);
                    }
            });

          }
          catch(err) {
            console.log(err);
          }

        });

        },
        error: function(xhr) {
        //Do Something to handle error
        console.log(xhr);
        }
});

} //end of SelectPoints function


function refreshEverything(){
    window.dispatchEvent(new Event('resize'))
    map.eachLayer(function (layer) {
        if (!layer._url) {
            map.removeLayer(layer);
        }
        if(legend !== null) {
        map.removeControl(legend);
        }
    });
}
    </script>

    <script>

    </script>
</body>

</html>
